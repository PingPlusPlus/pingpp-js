!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).pingpp=e()}(function(){return function r(t,l,i){function c(a,e){if(!l[a]){if(!t[a]){var n="function"==typeof require&&require;if(!e&&n)return n(a,!0);if(o)return o(a,!0);throw(e=new Error("Cannot find module '"+a+"'")).code="MODULE_NOT_FOUND",e}n=l[a]={exports:{}},t[a][0].call(n.exports,function(e){return c(t[a][1][e]||e)},n,n.exports,r,t,l,i)}return l[a].exports}for(var o="function"==typeof require&&require,e=0;e<i.length;e++)c(i[e]);return c}({1:[function(e,a,n){var r={}.hasOwnProperty,t=e('./callbacks'),l=e('./utils');a.exports={signAgreement:function(e){var a,n;if('string'==typeof e)try{a=JSON.parse(e)}catch(e){return t.innerAgreementCallback('fail',t.error('json_decode_fail',e)),!1}else a=e;return void 0===a?(t.innerAgreementCallback('fail',t.error('json_decode_fail')),!1):r.call(a,'object')&&'agreement'===a.object&&r.call(a,'channel')&&r.call(a,'credential')&&'object'==typeof a.credential?!r.call(a.credential,a.channel)||('string'==typeof(e=a.credential[a.channel])?n=e:r.call(e,'credential')&&'string'==typeof e.credential&&(n=e.credential),void 0===n)?(t.innerAgreementCallback('fail',t.error('invalid_credential')),!1):('alipay'===a.channel.substring(0,6)&&l.deviceDetectorMobile()&&(e=new URL(n),n='https://d.alipay.com/i/index.htm?iframeSrc='+encodeURIComponent("alipays://platformapi/startapp?appId=60000157&appClearTop=false&startMultApp=YES&sign_params="+encodeURIComponent(e.search.substring(1)))),setTimeout(function(){l.redirectTo(n)},0),!0):(t.innerAgreementCallback('fail',t.error('invalid_object')),!1)}}},{"./callbacks":2,"./utils":58}],2:[function(n,e,a){e.exports={userCallback:void 0,urlReturnCallback:void 0,urlReturnChannels:['alipay_pc_direct'],userAgreementCallback:void 0,userTransferCallback:void 0,innerCallback:function(e,a){'function'==typeof this.userCallback&&(void 0===a&&(a=this.error()),this.userCallback(e,a),this.userCallback=void 0,n('./payment_elements').clear())},error:function(e,a){return{msg:e=void 0===e?'':e,extra:a=void 0===a?'':a}},triggerUrlReturnCallback:function(e,a){'function'==typeof this.urlReturnCallback&&this.urlReturnCallback(e,a)},shouldReturnUrlByCallback:function(e){return'function'==typeof this.urlReturnCallback&&-1!==this.urlReturnChannels.indexOf(e)},innerAgreementCallback:function(e,a){'function'==typeof this.userAgreementCallback&&(void 0===a&&(a=this.error()),this.userAgreementCallback(e,a),this.userAgreementCallback=void 0)},innerTransferCallback:function(e,a){'function'==typeof this.userTransferCallback&&(void 0===a&&(a=this.error()),this.userTransferCallback(e,a),this.userTransferCallback=void 0)}}},{"./payment_elements":53}],3:[function(e,a,n){var r=e('../utils'),t=e('../callbacks');a.exports={handleCharge:function(e){var a=e.credential[e.channel];'string'==typeof a?r.redirectTo(a,e.channel):t.innerCallback('fail',t.error('invalid_credential','credential 格式不正确'))}}},{"../callbacks":2,"../utils":58}],4:[function(e,a,n){arguments[4][3][0].apply(n,arguments)},{"../callbacks":2,"../utils":58,dup:3}],5:[function(e,a,n){var r=e('../callbacks'),t={}.hasOwnProperty;a.exports={PINGPP_NOTIFY_URL_BASE:'https://notify.pingxx.com/notify',handleCharge:function(e){e=e.credential[e.channel];e||t.call(e,'orderInfo')?this.callpay(e.orderInfo):r.innerCallback('fail',r.error('invalid_credential','missing_alipay'))},alipayLiteEnabled:function(){return'undefined'!=typeof my&&my.tradePay},callpay:function(e){var a,n=this;return this.alipayLiteEnabled()?this.alipayLitePay(e):'undefined'!=typeof navigator&&/AlipayClient/.test(navigator.userAgent||navigator.swuserAgent)?this.waitAlipayJSBridgde(function(){n.alipayJsBridgePay(e)}):(a='请在支付宝小程序或者支付宝应用内中打开',console.log(a),void r.innerCallback('fail',r.error(a)))},waitAlipayJSBridgde:function(e){window.AlipayJSBridge?e&&e():document.addEventListener('AlipayJSBridgeReady',e,!1)},alipayJsBridgePay:function(e){AlipayJSBridge.call('tradePay',{orderStr:e},this.alipayResultHandler)},alipayLitePay:function(e){var a={};a.orderStr=e,a.complete=this.alipayResultHandler,my.tradePay(a)},alipayResultHandler:function(e){var a={resultCode:e.resultCode};t.call(e,'memo')&&(a.memo=e.memo),t.call(e,'result')&&(a.result=e.result),'9000'==e.resultCode?r.innerCallback('success',r.error('',a)):'6001'==e.resultCode?r.innerCallback('cancel',r.error('用户取消支付',a)):r.innerCallback('fail',r.error('支付失败',a))},runTestMode:function(e){e='/charges/'+e.id;my.httpRequest({url:this.PINGPP_NOTIFY_URL_BASE+e+'?livemode=false',success:function(e){'success'==e.data?r.innerCallback('success'):r.innerCallback('fail',r.error('testmode_notify_fail'))},fail:function(){r.innerCallback('fail',r.error('network_err'))}})}}},{"../callbacks":2}],6:[function(e,a,n){var r=e('../callbacks');a.exports={PINGPP_NOTIFY_URL_BASE:'https://notify.pingxx.com/notify',handleCharge:function(e){e=e.credential[e.channel];e?this.callpay(e):r.innerCallback('fail',r.error('invalid_credential','missing_alipay_lite'))},alipayLiteEnabled:function(){return'undefined'!=typeof my&&my.tradePay},callpay:function(e){var a;this.alipayLiteEnabled()?((a={}).tradeNO=e,a.complete=function(e){9e3==e.resultCode?r.innerCallback('success'):6001==e.resultCode?r.innerCallback('cancel',r.error('用户取消支付')):r.innerCallback('fail',r.error('支付失败'))},my.tradePay(a)):console.log('请在支付宝小程序中打开')},runTestMode:function(e){e='/charges/'+e.id;my.httpRequest({url:this.PINGPP_NOTIFY_URL_BASE+e+'?livemode=false',success:function(e){'success'==e.data?r.innerCallback('success'):r.innerCallback('fail',r.error('testmode_notify_fail'))},fail:function(){r.innerCallback('fail',r.error('network_err'))}})}}},{"../callbacks":2}],7:[function(e,a,n){var r=e('../utils'),t={}.hasOwnProperty;a.exports={ALIPAY_PC_DIRECT_URL:'https://mapi.alipay.com/gateway.do',handleCharge:function(e){var a=e.channel,e=e.credential[a],n=this.ALIPAY_PC_DIRECT_URL,e=(t.call(e,'channel_url')&&(n=e.channel_url),t.call(e,'_input_charset')||t.call(e,'service')&&'create_direct_pay_by_user'===e.service&&(e._input_charset='utf-8'),r.stringifyData(e,a,!0));r.redirectTo(n+'?'+e,a)}}},{"../utils":58}],8:[function(e,a,n){var r={}.hasOwnProperty,t=e('../callbacks');a.exports={handleCharge:function(e){e=e.credential[e.channel];r.call(e,'transaction_no')?this.tradePay(e.transaction_no):t.innerCallback('fail',t.error('invalid_credential','missing_field_transaction_no'))},ready:function(e){window.AlipayJSBridge?e&&e():document.addEventListener('AlipayJSBridgeReady',e,!1)},tradePay:function(e){this.ready(function(){AlipayJSBridge.call('tradePay',{tradeNO:e},function(e){'9000'==e.resultCode?t.innerCallback('success'):'6001'==e.resultCode?t.innerCallback('cancel',t.error(e.result)):t.innerCallback('fail',t.error(e.result))})})}}},{"../callbacks":2}],9:[function(e,a,n){var r=e('./commons/redirect_base');a.exports={handleCharge:function(e){r.handleCharge(e)}}},{"./commons/redirect_base":25}],10:[function(e,a,n){var r=e('../utils'),t=e('../mods'),l={}.hasOwnProperty;a.exports={ALIPAY_WAP_URL_OLD:'https://wappaygw.alipay.com/service/rest.htm',ALIPAY_WAP_URL:'https://mapi.alipay.com/gateway.do',handleCharge:function(e){var a=e.channel,e=e.credential[a],n=this.ALIPAY_WAP_URL,e=(l.call(e,'req_data')?n=this.ALIPAY_WAP_URL_OLD:l.call(e,'channel_url')&&(n=e.channel_url),l.call(e,'_input_charset')||(l.call(e,'service')&&'alipay.wap.create.direct.pay.by.user'===e.service||l.call(e,'req_data'))&&(e._input_charset='utf-8'),r.stringifyData(e,a,!0)),n=n+'?'+e,e=t.getExtraModule('ap');r.inWeixin()&&void 0!==e?e.pay(n):r.redirectTo(n,a)}}},{"../mods":52,"../utils":58}],11:[function(e,a,n){arguments[4][9][0].apply(n,arguments)},{"./commons/redirect_base":25,dup:9}],12:[function(e,a,n){var r=e('../utils'),t=e('../callbacks'),l={}.hasOwnProperty;a.exports={handleCharge:function(e){var a=e.channel,e=e.credential[a];l.call(e,'url')?r.redirectTo(e.url+'?'+r.stringifyData(e,a),a):t.innerCallback('fail',t.error('invalid_credential','missing_field:url'))}}},{"../callbacks":2,"../utils":58}],13:[function(e,a,n){var r=e('../utils'),t={}.hasOwnProperty;a.exports={ALIPAY_PC_DIRECT_URL:'https://intlmapi.alipay.com/gateway.do',handleCharge:function(e){var a=e.channel,e=e.credential[a],n=this.ALIPAY_PC_DIRECT_URL,e=(t.call(e,'channel_url')&&(n=e.channel_url),t.call(e,'_input_charset')||t.call(e,'service')&&'create_forex_trade'===e.service&&(e._input_charset='utf-8'),r.stringifyData(e,a,!0));r.redirectTo(n+'?'+e,a)}}},{"../utils":58}],14:[function(e,a,n){var r=e('../utils'),t=e('../mods'),l={}.hasOwnProperty;a.exports={ALIPAY_WAP_URL:'https://intlmapi.alipay.com/gateway.do',handleCharge:function(e){var a=e.channel,e=e.credential[a],n=this.ALIPAY_WAP_URL,e=(l.call(e,'channel_url')&&(n=e.channel_url),l.call(e,'_input_charset')||l.call(e,'service')&&'create_forex_trade_wap'===e.service&&(e._input_charset='utf-8'),r.stringifyData(e,a,!0)),n=n+'?'+e,e=t.getExtraModule('ap');r.inWeixin()&&void 0!==e?e.pay(n):r.redirectTo(n,a)}}},{"../mods":52,"../utils":58}],15:[function(e,a,n){var t=e('../callbacks'),r=e('../utils'),l=e('../stash'),i=e('../mods'),c={}.hasOwnProperty;a.exports={PINGPP_NOTIFY_URL_BASE:'https://notify.pingxx.com/notify',handleCharge:function(e){for(var a=e.credential[e.channel],n=['appId','timeStamp','nonceStr','package','signType','paySign'],r=0;r<n.length;r++)if(!c.call(a,n[r]))return void t.innerCallback('fail',t.error('invalid_credential','missing_field_'+n[r]));l.jsApiParameters=a,this.callpay()},callpay:function(){var e=this,a=i.getExtraModule('wx_jssdk');void 0!==a&&a.jssdkEnabled()?a.callpay():'undefined'==typeof WeixinJSBridge?(a=function(){e.jsApiCall()},document.addEventListener?document.addEventListener('WeixinJSBridgeReady',a,!1):document.attachEvent&&(document.attachEvent('WeixinJSBridgeReady',a),document.attachEvent('onWeixinJSBridgeReady',a))):this.jsApiCall()},jsApiCall:function(){c.call(l,'jsApiParameters')&&WeixinJSBridge.invoke('getBrandWCPayRequest',l.jsApiParameters,function(e){delete l.jsApiParameters,'get_brand_wcpay_request:ok'==e.err_msg?t.innerCallback('success'):'get_brand_wcpay_request:cancel'==e.err_msg?t.innerCallback('cancel'):t.innerCallback('fail',t.error('wx_result_fail',e.err_msg))})},runTestMode:function(e){confirm('模拟付款？')&&(e='/charges/'+e.id,r.request(this.PINGPP_NOTIFY_URL_BASE+e+'?livemode=false','GET',null,function(e,a){200<=a&&a<400&&'success'==e?t.innerCallback('success'):t.innerCallback('fail',t.error('testmode_notify_fail','http_code:'+a+';response:'+e))},function(){t.innerCallback('fail',t.error('network_err'))}))}}},{"../callbacks":2,"../mods":52,"../stash":54,"../utils":58}],16:[function(e,a,n){arguments[4][9][0].apply(n,arguments)},{"./commons/redirect_base":25,dup:9}],17:[function(e,a,n){var r=e('../utils'),t={}.hasOwnProperty,l=e('../callbacks');a.exports={CCB_WAP_URL_BASE:'https://ibsbjstar.ccb.com.cn/CCBIS/ccbMain?',handleCharge:function(e){var a=e.channel,e=e.credential[a];t.call(e,'orderinfo')?(e=this.CCB_WAP_URL_BASE+e.orderinfo,r.redirectTo(e,a)):l.innerCallback('fail',l.error('invalid_credential','missing_field:orderinfo'))}}},{"../callbacks":2,"../utils":58}],18:[function(e,a,n){var r=e('../utils'),t=e('../callbacks');a.exports={handleCharge:function(e){var a=e.credential[e.channel];'string'==typeof a?r.redirectTo(a,e.channel):t.innerCallback('fail',t.error('invalid_credential','credential 格式不正确'))}}},{"../callbacks":2,"../utils":58}],19:[function(e,a,n){arguments[4][18][0].apply(n,arguments)},{"../callbacks":2,"../utils":58,dup:18}],20:[function(e,a,n){var r=e('../utils'),t=e('../callbacks');a.exports={handleCharge:function(e){var a=e.credential[e.channel];'string'==typeof a?r.redirectTo(a,e.channel):t.innerCallback('fail',t.error('invalid_credential','credential 格式不正确'))}}},{"../callbacks":2,"../utils":58}],21:[function(e,a,n){arguments[4][18][0].apply(n,arguments)},{"../callbacks":2,"../utils":58,dup:18}],22:[function(e,a,n){arguments[4][18][0].apply(n,arguments)},{"../callbacks":2,"../utils":58,dup:18}],23:[function(e,a,n){var r=e('../utils'),t={}.hasOwnProperty;a.exports={handleCharge:function(e){var a,n=e.channel,e=e.credential[n];t.call(e,'channel_url')&&(a=e.channel_url,delete e.channel_url),r.formSubmit(a,'post',e)}}},{"../utils":58}],24:[function(e,a,n){var r=e('../utils'),t={}.hasOwnProperty;a.exports={CMB_WALLET_URL:'https://netpay.cmbchina.com/netpayment/BaseHttp.dll?MB_EUserPay',handleCharge:function(e){var e=e.credential[e.channel],a=this.CMB_WALLET_URL;t.call(e,'ChannelUrl')&&(a=e.ChannelUrl,delete e.ChannelUrl),t.call(e,'channelVersion')&&delete e.channelVersion,r.formSubmit(a,'post',e)}}},{"../utils":58}],25:[function(e,a,n){var r=e('../../utils'),t=e('../../callbacks'),l={}.hasOwnProperty;a.exports={handleCharge:function(e){var a,n=e.credential[e.channel];if('string'==typeof n)a=n;else{if(!l.call(n,'url'))return void t.innerCallback('fail',t.error('invalid_credential','credential format is incorrect'));a=n.url}r.redirectTo(a,e.channel)}}},{"../../callbacks":2,"../../utils":58}],26:[function(e,a,n){var r=e('../utils');a.exports={CP_B2B_URL:'https://payment.chinapay.com/CTITS/service/rest/page/nref/000000000017/0/0/0/0/0',handleCharge:function(e){e=e.credential[e.channel];r.formSubmit(this.CP_B2B_URL,'post',e)}}},{"../utils":58}],27:[function(e,a,n){var r,o,t=e('../../stash'),l={}.hasOwnProperty;o={PADCHAR:'=',ALPHA:'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',makeDOMException:function(){try{return new DOMException(DOMException.INVALID_CHARACTER_ERR)}catch(e){var a=new Error('DOM Exception 5');return a.code=a.number=5,a.name=a.description='INVALID_CHARACTER_ERR',a.toString=function(){return'Error: '+a.name+': '+a.message},a}},getbyte64:function(e,a){e=o.ALPHA.indexOf(e.charAt(a));if(-1===e)throw o.makeDOMException();return e},decode:function(e){var a,n,r=o.getbyte64,t=(e=''+e).length;if(0===t)return e;if(t%4!=0)throw o.makeDOMException();a=0,e.charAt(t-1)===o.PADCHAR&&(a=1,e.charAt(t-2)===o.PADCHAR&&(a=2),t-=4);for(var l=[],i=0;i<t;i+=4)n=r(e,i)<<18|r(e,i+1)<<12|r(e,i+2)<<6|r(e,i+3),l.push(String.fromCharCode(n>>16,n>>8&255,255&n));switch(a){case 1:n=r(e,i)<<18|r(e,i+1)<<12|r(e,i+2)<<6,l.push(String.fromCharCode(n>>16,n>>8&255));break;case 2:n=r(e,i)<<18|r(e,i+1)<<12,l.push(String.fromCharCode(n>>16))}return l.join('')},getbyte:function(e,a){e=e.charCodeAt(a);if(255<e)throw o.makeDOMException();return e},encode:function(e){if(1!==arguments.length)throw new SyntaxError('Not enough arguments');var a,n,r=o.PADCHAR,t=o.ALPHA,l=o.getbyte,i=[],c=(e=''+e).length-e.length%3;if(0===e.length)return e;for(a=0;a<c;a+=3)n=l(e,a)<<16|l(e,a+1)<<8|l(e,a+2),i.push(t.charAt(n>>18)),i.push(t.charAt(n>>12&63)),i.push(t.charAt(n>>6&63)),i.push(t.charAt(63&n));switch(e.length-c){case 1:n=l(e,a)<<16,i.push(t.charAt(n>>18)+t.charAt(n>>12&63)+r+r);break;case 2:n=l(e,a)<<16|l(e,a+1)<<8,i.push(t.charAt(n>>18)+t.charAt(n>>12&63)+t.charAt(n>>6&63)+r)}return i.join('')}},r={url:'pay.htm',pay:function(e){e=encodeURIComponent(o.encode(e));l.call(t,'APURL')&&(r.url=t.APURL),location.href=r.url+'?goto='+e},decode:function(e){return o.decode(decodeURIComponent(e))}},a.exports=r},{"../../stash":54}],28:[function(e,a,n){e=e('./wx_lite');a.exports=e},{"./wx_lite":39}],29:[function(e,a,n){var r=e('./commons/redirect_base'),t=e('../callbacks'),l=e('../utils'),i={}.hasOwnProperty;a.exports={handleCharge:function(e){var a=e.extra;i.call(a,'pay_channel')?'wx'!==(a=a.pay_channel)||l.inWeixin()?'alipay'!==a||l.inAlipay()?r.handleCharge(e):t.innerCallback('fail',t.error('Not in the Alipay browser')):t.innerCallback('fail',t.error('Not in the WeChat browser')):t.innerCallback('fail',t.error('invalid_charge','charge 格式不正确'))}}},{"../callbacks":2,"../utils":58,"./commons/redirect_base":25}],30:[function(e,a,n){var r=e('../utils'),t={}.hasOwnProperty;a.exports={JDPAY_WAP_URL_OLD:'https://m.jdpay.com/wepay/web/pay',JDPAY_H5_URL:'https://h5pay.jd.com/jdpay/saveOrder',JDPAY_PC_URL:'https://wepay.jd.com/jdpay/saveOrder',handleCharge:function(e){var e=e.credential[e.channel],a=this.JDPAY_H5_URL;t.call(e,'channelUrl')?(a=e.channelUrl,delete e.channelUrl):t.call(e,'merchantRemark')&&(a=this.JDPAY_WAP_URL_OLD),r.formSubmit(a,'post',e)}}},{"../utils":58}],31:[function(e,a,n){var r=e('../utils'),t={}.hasOwnProperty;a.exports={handleCharge:function(e){e=e.credential[e.channel];t.call(e,'bankUrl')&&(request_url=e.bankUrl,delete e.bankUrl),r.formSubmit(request_url,'post',e)}}},{"../utils":58}],32:[function(e,a,n){arguments[4][31][0].apply(n,arguments)},{"../utils":58,dup:31}],33:[function(e,a,n){var r=e('../utils');a.exports={handleCharge:function(e){var e=e.credential[e.channel],a=e.channelUrl;delete e.channelUrl,r.formSubmit(a,'post',e)}}},{"../utils":58}],34:[function(e,a,n){var r=e('../utils');a.exports={handleCharge:function(e){var a=e.credential[e.channel];r.redirectTo(a,e.channel)}}},{"../utils":58}],35:[function(e,a,n){var r=e('../callbacks'),t=e('../utils'),l=e('../stash'),i={}.hasOwnProperty;a.exports={SRC_URL:'https://open.mobile.qq.com/sdk/qqapi.js?_bid=152',ID:'mqq_api',handleCharge:function(e){e=e.credential[e.channel];i.call(e,'token_id')?(l.tokenId=e.token_id,t.loadUrlJs(this.ID,this.SRC_URL,this.callpay)):r.innerCallback('fail',r.error('invalid_credential','missing_token_id'))},callpay:function(){if('undefined'!=typeof mqq){if(0==mqq.QQVersion)return r.innerCallback('fail',r.error('Not in the QQ client')),void delete l.tokenId;mqq.tenpay.pay({tokenId:l.tokenId},function(e){0==e.resultCode?r.innerCallback('success'):r.innerCallback('fail',r.error(e.retmsg))})}else r.innerCallback('fail',r.error('network_err'));delete l.tokenId}}},{"../callbacks":2,"../stash":54,"../utils":58}],36:[function(e,a,n){arguments[4][23][0].apply(n,arguments)},{"../utils":58,dup:23}],37:[function(e,a,n){var r=e('../utils');a.exports={UPACP_PC_URL:'https://gateway.95516.com/gateway/api/frontTransReq.do',handleCharge:function(e){e=e.credential[e.channel];r.formSubmit(this.UPACP_PC_URL,'post',e)}}},{"../utils":58}],38:[function(e,a,n){var r=e('../utils');a.exports={UPACP_WAP_URL:'https://gateway.95516.com/gateway/api/frontTransReq.do',handleCharge:function(e){e=e.credential[e.channel];r.formSubmit(this.UPACP_WAP_URL,'post',e)}}},{"../utils":58}],39:[function(e,a,n){var t=e('../stash'),l=e('../callbacks'),i={}.hasOwnProperty;a.exports={PINGPP_NOTIFY_URL_BASE:'https://notify.pingxx.com/notify',handleCharge:function(e){for(var a=e.credential[e.channel],n=['appId','timeStamp','nonceStr','package','signType','paySign'],r=0;r<n.length;r++)if(!i.call(a,n[r]))return void l.innerCallback('fail',l.error('invalid_credential','missing_field_'+n[r]));t.jsApiParameters=a,this.callpay()},wxLiteEnabled:function(){return'undefined'!=typeof wx&&wx.requestPayment},callpay:function(){var e;this.wxLiteEnabled()?(delete(e=t.jsApiParameters).appId,e.complete=function(e){'requestPayment:ok'===e.errMsg&&l.innerCallback('success'),'requestPayment:cancel'!==e.errMsg&&'requestPayment:fail cancel'!==e.errMsg||l.innerCallback('cancel',l.error('用户取消支付')),'undefined'!==e.err_code&&'undefined'!==e.err_desc&&l.innerCallback('fail',l.error(e.err_desc,e))},wx.requestPayment(e)):console.log('请在微信小程序中打开')},runTestMode:function(e){e='/charges/'+e.id;wx.request({url:this.PINGPP_NOTIFY_URL_BASE+e+'?livemode=false',success:function(e){'success'==e.data?l.innerCallback('success'):l.innerCallback('fail',l.error('testmode_notify_fail'))},fail:function(){l.innerCallback('fail',l.error('network_err'))}})}}},{"../callbacks":2,"../stash":54}],40:[function(e,a,n){arguments[4][28][0].apply(n,arguments)},{"./wx_lite":39,dup:28}],41:[function(e,a,n){arguments[4][15][0].apply(n,arguments)},{"../callbacks":2,"../mods":52,"../stash":54,"../utils":58,dup:15}],42:[function(e,a,n){e=e('./wx_pub');a.exports=e},{"./wx_pub":41}],43:[function(e,a,n){var r=e('../utils'),t=e('../callbacks'),l={}.hasOwnProperty;a.exports={handleCharge:function(e){var a=e.credential[e.channel];'string'==typeof a?r.redirectTo(a,e.channel):'object'==typeof a&&l.call(a,'url')?r.redirectTo(a.url,e.channel):t.innerCallback('fail',t.error('invalid_credential','credential 格式不正确'))}}},{"../callbacks":2,"../utils":58}],44:[function(e,a,n){var i=e('../utils'),c=e('../callbacks'),o={}.hasOwnProperty;a.exports={YEEPAY_WAP_URL:'https://ok.yeepay.com/paymobile/api/pay/request',YEEPAY_WAP_TEST_URL:'https://mobiletest.yeepay.com/paymobile/api/pay/request',handleCharge:function(e){for(var a,n=e.channel,r=e.credential[n],t=['merchantaccount','encryptkey','data'],l=0;l<t.length;l++)if(!o.call(r,t[l]))return void c.innerCallback('fail',c.error('invalid_credential','missing_field_'+t[l]));a=o.call(r,'mode')&&'test'==r.mode?this.YEEPAY_WAP_TEST_URL:this.YEEPAY_WAP_URL,i.redirectTo(a+'?'+i.stringifyData(r,n,!0),e.channel)}}},{"../callbacks":2,"../utils":58}],45:[function(e,a,n){e=e('./wx_lite');a.exports=e},{"./wx_lite":39}],46:[function(e,a,n){arguments[4][45][0].apply(n,arguments)},{"./wx_lite":39,dup:45}],47:[function(e,a,n){arguments[4][42][0].apply(n,arguments)},{"./wx_pub":41,dup:42}],48:[function(e,a,n){arguments[4][42][0].apply(n,arguments)},{"./wx_pub":41,dup:42}],49:[function(e,a,n){a.exports={Error:function(e,a){this.message=e,this.extra=a}}},{}],50:[function(e,a,n){var r=e('./stash'),t=e('./utils');a.exports={init:function(){var e=this;t.documentReady(function(){try{t.inWxLite()||t.inAlipayLite()||e.initPuid()}catch(e){}})},initPuid:function(){if('undefined'!=typeof window&&'undefined'!=typeof localStorage&&null!==localStorage){var e=localStorage.getItem('pingpp_uid');if(null===e){e=t.randomString();try{localStorage.setItem('pingpp_uid',e)}catch(e){}}r.puid=e}}}},{"./stash":54,"./utils":58}],51:[function(e,a,n){function PingppSDK(){e('./init').init()}var r=e('./version').v,t={}.hasOwnProperty,l=(PingppSDK.prototype.version=r,a.exports=new PingppSDK,e('./testmode')),i=e('./callbacks'),c=e('./errors').Error,o=e('./mods'),s=e('./stash'),u=e('./payment_elements'),p=e('./transfer_elements');PingppSDK.prototype.createPayment=function(e,a,n,r){'function'==typeof a&&(i.userCallback=a);try{u.init(e)}catch(e){if(e instanceof c)return void i.innerCallback('fail',i.error(e.message,e.extra));throw e}t.call(u,'id')?t.call(u,'channel')?(t.call(u,'app')&&('string'==typeof u.app?s.app_id=u.app:'object'==typeof u.app&&'string'==typeof u.app.id&&(s.app_id=u.app.id)),a=u.channel,t.call(u,'credential')?u.paid&&0===u.actual_amount?i.innerCallback('success'):u.credential?t.call(u.credential,a)?t.call(u,'livemode')?void 0===(e=o.getChannelModule(a))?(console.error('channel module "'+a+'" is undefined'),i.innerCallback('fail',i.error('invalid_channel','channel module "'+a+'" is undefined'))):!1===u.livemode?(t.call(e,'runTestMode')?e:l).runTestMode(u):(void 0!==n&&(s.signature=n),'boolean'==typeof r&&(s.debug=r),e.handleCharge(u)):i.innerCallback('fail',i.error('invalid_charge','no_livemode_field')):i.innerCallback('fail',i.error('invalid_credential','credential_is_incorrect')):i.innerCallback('fail',i.error('invalid_credential','credential_is_undefined')):i.innerCallback('fail',i.error('invalid_charge','no_credential'))):i.innerCallback('fail',i.error('invalid_charge','no_channel')):i.innerCallback('fail',i.error('invalid_charge','no_charge_id'))},PingppSDK.prototype.setAPURL=function(e){s.APURL=e},PingppSDK.prototype.setUrlReturnCallback=function(e,a){if('function'!=typeof e)throw'callback need to be a function';if(i.urlReturnCallback=e,void 0!==a){if(!Array.isArray(a))throw'channels need to be an array';i.urlReturnChannels=a}},PingppSDK.prototype.signAgreement=function(e,a){'function'==typeof a&&(i.userAgreementCallback=a);a=o.getExtraModule('agreement');return void 0===a?(console.error('module "agreement" is undefined'),i.innerCallback('fail',i.error('invalid_module','module "agreement" is undefined')),!1):a.signAgreement(e)},PingppSDK.prototype.createTransfer=function(e,a){"function"==typeof a&&(i.userTransferCallback=a);try{p.init(e)}catch(e){if(e instanceof c)return void i.innerTransferCallback("fail",i.error(e.message,e.extra));throw e}t.call(p,"id")?t.call(p,"channel")?(t.call(p,"app")&&("string"==typeof p.app?s.app_id=p.app:"object"==typeof p.app&&"string"==typeof p.app.id&&(s.app_id=p.app.id)),a=p.channel,t.call(p,"extra")?"paid"===p.status?i.innerTransferCallback("success"):p.extra?t.call(p,"livemode")?void 0===(e=o.getTransferChannelModule(a))?(console.error('transfer channel module "'+a+'" is undefined'),i.innerTransferCallback("fail",i.error("invalid_channel",'transfer channel module "'+a+'" is undefined'))):!1===p.livemode?i.innerTransferCallback("fail",i.error("invalid_transfer","testmode_not_supported")):("undefined"!=typeof signature&&(s.signature=signature),"boolean"==typeof debug&&(s.debug=debug),e.handleTransfer(p)):i.innerTransferCallback("fail",i.error("invalid_transfer","no_livemode_field")):i.innerTransferCallback("fail",i.error("invalid_credential","credential_is_undefined")):i.innerTransferCallback("fail",i.error("invalid_transfer","no_credential"))):i.innerTransferCallback("fail",i.error("invalid_transfer","no_channel")):i.innerTransferCallback("fail",i.error("invalid_transfer","no_transfer_id"))}},{"./callbacks":2,"./errors":49,"./init":50,"./mods":52,"./payment_elements":53,"./stash":54,"./testmode":55,"./transfer_elements":57,"./version":59}],52:[function(e,a,n){var r={}.hasOwnProperty,t={};(a.exports=t).channels={abc_pay:e('./channels/abc_pay'),abc_pub:e('./channels/abc_pub'),alipay:e('./channels/alipay'),alipay_lite:e('./channels/alipay_lite'),alipay_pc_direct:e('./channels/alipay_pc_direct'),alipay_qr:e('./channels/alipay_qr'),alipay_qr_lakala:e('./channels/alipay_qr_lakala'),alipay_wap:e('./channels/alipay_wap'),alipay_wap_lakala:e('./channels/alipay_wap_lakala'),bfb_wap:e('./channels/bfb_wap'),cb_alipay_pc_direct:e('./channels/cb_alipay_pc_direct'),cb_alipay_wap:e('./channels/cb_alipay_wap'),cb_wx_pub:e('./channels/cb_wx_pub'),ccb_qr:e('./channels/ccb_qr'),ccb_wap:e('./channels/ccb_wap'),chinaums_alipay_pub:e('./channels/chinaums_alipay_pub'),chinaums_alipay_wap:e('./channels/chinaums_alipay_wap'),chinaums_upacp_wap:e('./channels/chinaums_upacp_wap'),chinaums_wx_pub:e('./channels/chinaums_wx_pub'),chinaums_wx_wap:e('./channels/chinaums_wx_wap'),cmb_pc_qr:e('./channels/cmb_pc_qr'),cmb_wallet:e('./channels/cmb_wallet'),cp_b2b:e('./channels/cp_b2b'),isv_lite:e('./channels/isv_lite'),isv_wap:e('./channels/isv_wap'),jdpay_wap:e('./channels/jdpay_wap'),nucc_b2b_lakala:e('./channels/nucc_b2b_lakala'),nucc_b2c_lakala:e('./channels/nucc_b2c_lakala'),pab_pc:e('./channels/pab_pc'),paypal:e('./channels/paypal'),qpay_pub:e('./channels/qpay_pub'),upacp_b2b:e('./channels/upacp_b2b'),upacp_pc:e('./channels/upacp_pc'),upacp_wap:e('./channels/upacp_wap'),wx_lite:e('./channels/wx_lite'),wx_lite_pab:e('./channels/wx_lite_pab'),wx_pub:e('./channels/wx_pub'),wx_pub_pab:e('./channels/wx_pub_pab'),wx_wap:e('./channels/wx_wap'),yeepay_wap:e('./channels/yeepay_wap'),yeepay_wx_lite:e('./channels/yeepay_wx_lite'),yeepay_wx_lite_ofl:e('./channels/yeepay_wx_lite_ofl'),yeepay_wx_pub:e('./channels/yeepay_wx_pub'),yeepay_wx_pub_ofl:e('./channels/yeepay_wx_pub_ofl')},t.extras={ap:e('./channels/extras/ap'),agreement:e('./agreement')},t.transferChannels={wx_pub:e('./transfer_channels/wx_pub')},t.getChannelModule=function(e){if(r.call(t.channels,e))return t.channels[e]},t.getTransferChannelModule=function(e){if(r.call(t.transferChannels,e))return t.transferChannels[e]},t.getExtraModule=function(e){if(r.call(t.extras,e))return t.extras[e]}},{"./agreement":1,"./channels/abc_pay":3,"./channels/abc_pub":4,"./channels/alipay":5,"./channels/alipay_lite":6,"./channels/alipay_pc_direct":7,"./channels/alipay_qr":8,"./channels/alipay_qr_lakala":9,"./channels/alipay_wap":10,"./channels/alipay_wap_lakala":11,"./channels/bfb_wap":12,"./channels/cb_alipay_pc_direct":13,"./channels/cb_alipay_wap":14,"./channels/cb_wx_pub":15,"./channels/ccb_qr":16,"./channels/ccb_wap":17,"./channels/chinaums_alipay_pub":18,"./channels/chinaums_alipay_wap":19,"./channels/chinaums_upacp_wap":20,"./channels/chinaums_wx_pub":21,"./channels/chinaums_wx_wap":22,"./channels/cmb_pc_qr":23,"./channels/cmb_wallet":24,"./channels/cp_b2b":26,"./channels/extras/ap":27,"./channels/isv_lite":28,"./channels/isv_wap":29,"./channels/jdpay_wap":30,"./channels/nucc_b2b_lakala":31,"./channels/nucc_b2c_lakala":32,"./channels/pab_pc":33,"./channels/paypal":34,"./channels/qpay_pub":35,"./channels/upacp_b2b":36,"./channels/upacp_pc":37,"./channels/upacp_wap":38,"./channels/wx_lite":39,"./channels/wx_lite_pab":40,"./channels/wx_pub":41,"./channels/wx_pub_pab":42,"./channels/wx_wap":43,"./channels/yeepay_wap":44,"./channels/yeepay_wx_lite":45,"./channels/yeepay_wx_lite_ofl":46,"./channels/yeepay_wx_pub":47,"./channels/yeepay_wx_pub_ofl":48,"./transfer_channels/wx_pub":56}],53:[function(e,a,n){var l=e('./errors').Error,i={}.hasOwnProperty;a.exports={id:null,or_id:null,channel:null,app:null,credential:{},extra:null,livemode:null,order_no:null,time_expire:null,paid:!1,status:null,actual_amount:null,init:function(e){var a,n;if('string'==typeof e)try{a=JSON.parse(e)}catch(e){throw new l('json_decode_fail',e)}else a=e;if(void 0===a)throw new l('json_decode_fail');if(i.call(a,'object')&&'order'==a.object){a.or_id=a.id,a.order_no=a.merchant_order_no;var r=a.charge_essentials;if(a.channel=r.channel,a.credential=r.credential,a.extra=r.extra,i.call(a,'charge')&&null!=a.charge)a.id=a.charge;else if(i.call(r,'id')&&null!=r.id)a.id=r.id;else if(i.call(a,'charges'))for(var t=0;t<a.charges.data.length;t++)if(a.charges.data[t].channel===r.channel){a.id=a.charges.data[t].id;break}}else i.call(a,'object')&&'recharge'==a.object&&(a=a.charge);for(n in this)i.call(a,n)&&(this[n]=a[n]);return this},clear:function(){for(var e in this)'function'!=typeof this[e]&&(this[e]=null)}}},{"./errors":49}],54:[function(e,a,n){a.exports={}},{}],55:[function(e,a,n){var r=e('./utils'),t={}.hasOwnProperty;a.exports={PINGPP_MOCK_URL:'https://sissi.pingxx.com/mock.php',runTestMode:function(e){var a={ch_id:e.id,scheme:'http',channel:e.channel};t.call(e,'order_no')?a.order_no=e.order_no:t.call(e,'orderNo')&&(a.order_no=e.orderNo),t.call(e,'time_expire')?a.time_expire=e.time_expire:t.call(e,'timeExpire')&&(a.time_expire=e.timeExpire),t.call(e,'extra')&&(a.extra=encodeURIComponent(JSON.stringify(e.extra))),r.redirectTo(this.PINGPP_MOCK_URL+'?'+r.stringifyData(a),e.channel)}}},{"./utils":58}],56:[function(e,a,n){var t=e('../callbacks'),l=e('../stash'),r=e('../mods'),i={}.hasOwnProperty;a.exports={handleTransfer:function(a){var n={},r=['appId','mchId','package'];for(let e=0;e<r.length;e++){if(!i.call(a.extra,r[e]))return t.innerTransferCallback('fail',t.error('invalid_credential','missing_field_'+r[e])),void console.error(r[e]);n[r[e]]=a.extra[r[e]]}l.jsApiParameters=n,this.callTransfer()},callTransfer:function(){const e=this;var a=r.getExtraModule('wx_jssdk');void 0!==a&&a.jssdkEnabled()?a.callpay():'undefined'==typeof WeixinJSBridge?(a=function(){e.jsApiCall()},'undefined'==typeof document?t.innerTransferCallback("fail",t.error("invalid_environment","document_is_undefined")):document.addEventListener?document.addEventListener('WeixinJSBridgeReady',a,!1):document.attachEvent&&(document.attachEvent('WeixinJSBridgeReady',a),document.attachEvent('onWeixinJSBridgeReady',a))):this.jsApiCall()},jsApiCall:function(){i.call(l,'jsApiParameters')&&WeixinJSBridge.invoke('requestMerchantTransfer',l.jsApiParameters,function(e){delete l.jsApiParameters,'requestMerchantTransfer:ok'===e.err_msg?t.innerTransferCallback("success"):'requestMerchantTransfer:cancel'===e.err_msg?t.innerTransferCallback("cancel"):t.innerTransferCallback("fail",t.error("wx_result_fail",e.err_msg))})}}},{"../callbacks":2,"../mods":52,"../stash":54}],57:[function(e,a,n){var r=e('./errors').Error,t={}.hasOwnProperty;a.exports={id:null,channel:null,app:null,extra:null,livemode:null,
order_no:null,time_expire:null,status:null,init:function(e){let a;if('string'==typeof e)try{a=JSON.parse(e)}catch(e){throw new r('json_decode_fail',e)}else a=e;if(void 0===a)throw new r('json_decode_fail');for(var n in this)t.call(a,n)&&(this[n]=a[n]);return this},clear:function(){for(var e in this)'function'!=typeof this[e]&&(this[e]=null)}}},{"./errors":49}],58:[function(e,a,n){var r=e('./callbacks'),o={}.hasOwnProperty,s=a.exports={stringifyData:function(e,a,n){void 0===n&&(n=!1);var r,t=[];for(r in e)!o.call(e,r)||'function'==typeof e[r]||'bfb_wap'==a&&'url'==r||'yeepay_wap'==a&&'mode'==r||'channel_url'!=r&&t.push(r+'='+(n?encodeURIComponent(e[r]):e[r]));return t.join('&')},request:function(e,a,n,r,t,l){if('undefined'==typeof XMLHttpRequest)console.log('Function XMLHttpRequest is undefined.');else{var i=new XMLHttpRequest;if(void 0!==i.timeout&&(i.timeout=6e3),'GET'===(a=a.toUpperCase())&&'object'==typeof n&&n&&(e+='?'+s.stringifyData(n,'',!0)),i.open(a,e,!0),void 0!==l)for(var c in l)o.call(l,c)&&i.setRequestHeader(c,l[c]);'POST'===a?(i.setRequestHeader('Content-type','application/json; charset=utf-8'),i.send(JSON.stringify(n))):i.send(),void 0===r&&(r=function(){}),void 0===t&&(t=function(){}),i.onreadystatechange=function(){4==i.readyState&&r(i.responseText,i.status,i)},i.onerror=function(e){t(i,0,e)}}},formSubmit:function(e,a,n){if('undefined'==typeof window)console.log('Not a browser, form submit url: '+e);else{var r,t,l=document.createElement('form');for(r in l.setAttribute('method',a),l.setAttribute('action',e),n)o.call(n,r)&&((t=document.createElement('input')).setAttribute('type','hidden'),t.setAttribute('name',r),t.setAttribute('value',n[r]),l.appendChild(t));document.body.appendChild(l),l.submit()}},randomString:function(e){void 0===e&&(e=32);for(var a='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',n=a.length,r='',t=0;t<e;t++)r+=a.charAt(Math.floor(Math.random()*n));return r},redirectTo:function(e,a){r.shouldReturnUrlByCallback(a)?r.triggerUrlReturnCallback(null,e):'undefined'==typeof window?console.log('Not a browser, redirect url: '+e):window.location.href=e},inWeixin:function(){return'undefined'!=typeof navigator&&-1!==navigator.userAgent.toLowerCase().indexOf('micromessenger')},inAlipay:function(){return'undefined'!=typeof navigator&&-1!==navigator.userAgent.toLowerCase().indexOf('alipayclient')},inWxLite:function(){return'undefined'!=typeof wx&&(wx.miniProgram||wx.requestPayment)},inAlipayLite:function(){return'undefined'!=typeof my&&my.tradePay},documentReady:function(e){'undefined'==typeof document||'loading'!=document.readyState?e():document.addEventListener('DOMContentLoaded',e)},loadUrlJs:function(e,a,n){var r=document.getElementsByTagName('head')[0],t=null;null==document.getElementById(e)?((t=document.createElement('script')).setAttribute('type','text/javascript'),t.setAttribute('src',a),t.setAttribute('id',e),t.async=!0,null!=n&&(t.onload=t.onreadystatechange=function(){if(t.ready)return!1;t.readyState&&'loaded'!=t.readyState&&'complete'!=t.readyState||(t.ready=!0,n())}),r.appendChild(t)):null!=n&&n()},deviceDetectorMobile:function(){return/Mobi/.test(window.navigator.userAgent)}}},{"./callbacks":2}],59:[function(e,a,n){a.exports={v:'2.4.0'}},{}]},{},[51])(51)});